### 分析AS isoform的编码框

> 可变剪切产生提前终止的密码子，可能会导致对应功能的缺失或者发生分化；如果这个转录本被翻译出来，就可能导致同源基因在功能上发生分化；重复基因间AS的差异可能会导致基因非功能发生进化，也可能保留一些重复基因

### 安装EMBOSS

> 编译的时候确实一个libnucleus.so.6库
>
> 下载地址ftp://ftp.pbone.net/mirror/ftp5.gwdg.de/pub/opensuse/repositories/home:/joscott/CentOS_CentOS-6/x86_64/EMBOSS-libs-6.6.0-6.2.x86_64.rpm

```bash
##使用yum安装这个库
yum localinstall EMBOSS-libs-6.6.0-6.2.x86_64.rpm
##提示缺失库时，接着下载就行
地址 http://rpm.pbone.net/index.php3/stat/4/idpl/54929788/dir/centos_6/com/EMBOSS-libs-6.6.0-6.2.x86_64.rpm.html
```

#### 预测isoform的ORF

+ PacBio文件中保存的是DNA的正链信息
+ 参考基因组中保存的则是有义链的信息

> 使用merge.gtf中的注释信息提取对应的cDNA序列这一步很关键

```bash
##提取对应的isoform序列，这里根据比对的得到的gtf文件提取对应的cDNA序列信息
python ~/github/zpliuCode/script/genestruct/getcDNAsequence.py ~/work/Alternative/data/Ghirsutum_genome_HAU_v1.0/Ghirsutum_genome_HAU_v1.0.fasta merge.gtf  cDNA.fa
##预测ORF
/public/home/software/opt/bio/software/EMBOSS/6.5.7/bin/getorf   -find 1 -noreverse -sequence cDNA.fa 
```

#### 与参考基因组转录本的ORF进行比较

```bash
python ~/github/zpliuCode/script/genestruct/compareToreference.py -refgtf Ghirsutum_gene_model.gtf -PBgtf merge.gtf -reforf TM1_reference.orf -PBorf mappingTogene.orf  -o test.txt 
```

## 转录本ORF的统计

统计annotion转录本中ORF的数据与unannotion转录本的ORF数据

+ 表达水平
+ 转录本长度
+ ORF长度
+ 可变剪切的比例

#### 与参考基因组编码框比较对转录本进行分类

+ in-frame change
+ frameshift
+ unchange ORF
+ other

```bash
for i in 1
do
##other类型
grep noreference ORF.txt|wc -l
awk '$4==""{print $0}' ORF.txt |wc -l
##没有改变编码框的前提下，改变了氨基酸序列
grep inframeChange  ORF.txt|wc -l
awk '$9=="noframeshift"&&($4!=$7||$5!=$8){print $0}' ORF.txt |wc -l
##ORF没有改变
awk '$9=="noframeshift"&&$4==$7&&$5==$8{print $0}' ORF.txt |wc -l
##改变了编码框
awk '$9=="frameshift"{print $0}' ORF.txt |wc -l
done
```

| 基因组 | inframeChange | frameshift | unchange ORF and frameshift | Other |
| ------ | ------------- | ---------- | --------------------------- | ----- |
| A2     | 14225         | 17318      | 23402                       | 12168 |
| D5     | 12015         | 12755      | 22578                       | 4616  |
| TM1    | 19030         | 21449      | 30082                       | 12831 |

#### 针对ORF的分类去对Annotion与unAnnotion两种转录本进行注释

> 可以看出Annotion转录本的ORF大部分与参考基因组是一致的；而unAnnotion转录本的ORF大部分发生了frameshift和inframeChange

```bash
python AddAnnotionTag.py  ../collapse/PacBio_Annotion/all_isoform.txt  ORF.txt  11
for i in 1
do
##没有改变编码框的前提下，改变了氨基酸序列
awk '$NF=="unAnnotion"{print $0}' ORF_Annotion.txt|grep inframeChange |wc -l
awk '$NF=="unAnnotion"{print $0}' ORF_Annotion.txt|awk '$9=="noframeshift"&&($4!=$7||$5!=$8){print $0}' |wc -l
##ORF没有改变
awk '$NF=="unAnnotion"{print $0}' ORF_Annotion.txt|awk '$9=="noframeshift"&&$4==$7&&$5==$8{print $0}' |wc -l
##改变了编码框
awk '$NF=="unAnnotion"{print $0}' ORF_Annotion.txt|awk '$9=="frameshift"{print $0}'  |wc -l
done
```

| 转录本类型     | inframeChange | frameshift | unchange ORF |
| -------------- | ------------- | ---------- | ------------ |
| TM1_Annotion   | 13070         | 4933       | 25816        |
| TM1_unAnnotion | 10228         | 12248      | 4266         |
| A2_Annotion    | 7106          | 3221       | 15484        |
| A2_unAnnotion  | 13464         | 7754       | 7918         |
| D5_Annotion    | 9805          | 3884       | 19872        |
| D5_unAnnotion  | 7073          | 4008       | 2706         |

#### 两种转录本在终止密码子上的分析

+ 终止密码子没改变，但是ORF改变了 //这里就包括了好几种情况
+ 提前终止的密码子
+ 滞后的终止密码子
+ 终止密码子和ORF都没有发生改变
+ Other类型

```bash
for i in 1
do
##终止密码子没变，ORF改变了
awk '$(NF)=="unAnnotion"{print $0}' ORF_Annotion.txt |grep inframeChange |wc -l
awk '$(NF)=="unAnnotion"{print $0}' ORF_Annotion.txt |awk '$4!=$7&&$5==$8{print $0}'|wc -l
##提前终止的密码子
awk '$(NF)=="unAnnotion"{print $0}' ORF_Annotion.txt |awk '$10=="earlyStop"{print $0}'  |wc -l
##滞后的终止密码子
awk '$(NF)=="unAnnotion"{print $0}' ORF_Annotion.txt |awk '$11=="laterStop"{print $0}'  |wc -l
##终止密码子和ORF都没有改变
awk '$(NF)=="unAnnotion"{print $0}' ORF_Annotion.txt |awk '$9=="noframeshift"&&$4==$7&&$5==$8{print $0}' |wc -l
done
```



| 转录本类型    | 终止密码子没变ORF改变了 | 提前终止密码子 | 滞后终止的密码子 | 终止密码子和ORF都没改变 |
| ------------- | ----------------------- | -------------- | ---------------- | ----------------------- |
| TM_Annotion   | 9472                    | 7143           | 1434             | 25816                   |
| TM_unAnnotion | 13056                   | 8800           | 977              | 4266                    |
| A2_Annotion   | 4858                    | 5579           | 26               | 15484                   |
| A2_unAnnotion | 11923                   | 9100           | 466              | 7918                    |
| D5_Annotion   | 6616                    | 6201           | 911              | 19872                   |
| D5_unAnnotion | 6408                    | 4275           | 617              | 2706                    |

#### 两种转录本表达量存在差异

> 从ORF的数据来看，unAnnotion转录本大部分发生了ORF的改变；同时两者的表达水平存在差异；这个分析可以说明编码框的改变可能会导致基因表达水平的改变；
>

```bash
##提取转录本的表达水平
awk 'NR>=2{print $6"\t"$6"\t"$0}' /public/home/zpliu/work/Alternative/result/homologo/FEST3/geneExpress/stringtie/TM1/t_data.ctab >all_isoform_FPKM
##给转录本打上Annotion或者是unAnnotion的标签
python ~/work/Alternative/result/Gh_result/CO31_32_result/ORF/AddAnnotionTag.py  all_isoform.txt  all_isoform_FPKM  11
mv 11 all_isoform_FPKM
##给所有转录本打上是否AS的标签
python ../ORF/AddAnnotionTag.py  Alternative_isoform.txt  ../collapse/PacBio_Annotion/all_isoform_FPKM all_isoform_FPKM
```

> AS可能改变编码框使得转录本水平发生改变

```bash
##分析每种剪切中有多少比例的in-frame change，多少比例的early stop
python ~/work/Alternative/result/Gh_result/CO31_32_result/ORF/AddAnnotionTag.py  ../ORF/ORF.txt  A3_isoform.txt  A3_ORF.txt 

##发生early stop的比例
for i in RI SE A3 A5
do
awk '$13=="earlyStop"{a+=1}END{print a/NR}'  ${i}_ORF.txt 
##发生in-frame change的比例
awk '$12=="noframeshift"&&($4!=$7||$5!=$8){a+=1}$12=="inframeChange"{a+=1}END{print a/NR}' ${i}_ORF.txt
done
```





